<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.demo.sl.dao.user.IUserDao">

    <resultMap id="userMap" type="com.demo.sl.entity.User">
        <id property="id" column="id"/>
        <result property="loginCode" column="loginCode"/>
        <result property="password" column="password"/>
        <result property="password2" column="password2"/>
        <result property="userName" column="userName"/>
        <result property="sex" column="sex"/>
        <result property="birthday" column="birthday"/>
        <result property="cardType" column="cardType"/>
        <result property="cardTypeName" column="cardTypeName"/>
        <result property="idCard" column="idCard"/>
        <result property="country" column="country"/>
        <result property="mobile" column="mobile"/>
        <result property="email" column="email"/>
        <result property="userAddress" column="userAddress"/>
        <result property="postCode" column="postCode"/>
        <result property="createTime" column="createTime"/>
        <result property="referId" column="referId"/>
        <result property="referCode" column="referCode"/>
        <result property="roleId" column="roleId"/>
        <result property="roleName" column="roleName"/>
        <result property="userType" column="userType"/>
        <result property="userTypeName" column="userTypeName"/>
        <result property="isStart" column="isStart"/>
        <result property="lastUpdateTime" column="lastUpdateTime"/>
        <result property="lastLoginTime" column="lastLoginTime"/>
        <result property="bankName" column="bankName"/>
        <result property="bankAccount" column="bankAccount"/>
        <result property="accountHolder" column="accountHolder"/>
        <result property="idCardPicPath" column="idCardPicPath"/>
        <result property="bankPicPath" column="bankPicPath"/>
    </resultMap>
    <select id="userLogin" resultMap="userMap">
        SELECT * FROM au_user WHERE loginCode=#{loginCode}
    </select>
    <update id="updateUserTable">
        UPDATE au_user
        <trim prefix="SET" suffixOverrides=",">
            <if test="loginCode!=null">loginCode=#{loginCode},</if>
            <if test="password!=null">password=#{password},</if>
            <if test="password2!=null">password2=#{password2},</if>
            <if test="userName!=null">userName=#{userName},</if>
            <if test="sex!=null">sex=#{sex},</if>
            <if test="birthday!=null">birthday=#{birthday},</if>
            <if test="cardType!=null">cardType=#{cardType},</if>
            <if test="cardTypeName!=null">cardTypeName=#{cardTypeName},</if>
            <if test="idCard!=null">idCard=#{idCard},</if>
            <if test="country!=null">country=#{country},</if>
            <if test="mobile!=null">mobile=#{mobile},</if>
            <if test="email!=null">email=#{email},</if>
            <if test="userAddress!=null">userAddress=#{userAddress},</if>
            <if test="postCode!=null">postCode=#{postCode},</if>
            <if test="createTime!=null">createTime=#{createTime},</if>
            <if test="referId!=null">referId=#{referId},</if>
            <if test="referCode!=null">referCode=#{referCode},</if>
            <if test="roleId!=null">roleId=#{roleId},</if>
            <if test="roleName!=null">roleName=#{roleName},</if>
            <if test="userType!=null">userType=#{userType},</if>
            <if test="userTypeName!=null">userTypeName=#{userTypeName},</if>
            <if test="isStart!=null">isStart=#{isStart},</if>
            <if test="lastUpdateTime!=null">lastUpdateTime=#{lastUpdateTime},</if>
            <if test="lastLoginTime!=null">lastLoginTime=#{lastLoginTime},</if>
            <if test="bankName!=null">bankName=#{bankName},</if>
            <if test="bankAccount!=null">bankAccount=#{bankAccount},</if>
            <if test="accountHolder!=null">accountHolder=#{accountHolder},</if>
            <if test="idCardPicPath!=null">idCardPicPath=#{idCardPicPath},</if>
            <if test="bankPicPath!=null">bankPicPath=#{bankPicPath},</if>
        </trim>
        WHERE id=#{id}
    </update>
    <!--得到user表中的总数-->
    <select id="userCount" resultType="int" parameterType="com.demo.sl.entity.User">
        SELECT COUNT(*) FROM au_user
        <trim prefix="where" prefixOverrides="and | or">
            <if test="loginCode!=null">
                and loginCode LIKE #{loginCode}
            </if>
            <if test="referCode!=null">
                and referCode LIKE #{referCode}
            </if>
            <if test="roleId!=null">
                and roleId=#{roleId}
            </if>
            <if test="isStart!=null">
                and isStart=#{isStart}
            </if>
        </trim>
    </select>
    <!--得到user表的详细内容-->
    <select id="getUserList" resultMap="userMap">
        SELECT * FROM au_user
        <trim prefix="where" prefixOverrides="and | or">
            <if test="loginCode!=null">
                and loginCode LIKE #{loginCode}
            </if>
            <if test="referCode!=null">
                and referCode LIKE #{referCode}
            </if>
            <if test="roleId!=null">
                and roleId=#{roleId}
            </if>
            <if test="isStart!=null">
                and isStart=#{isStart}
            </if>
        </trim>
        ORDER BY createTime DESC limit #{startNum},#{pageSize}
    </select>
    <select id="getLoginCodeIsExit" resultType="int" parameterType="com.demo.sl.entity.User">
        SELECT count(*) FROM au_user
        <trim prefix="where" prefixOverrides="and | or">
            <if test="loginCode!=null">
                AND loginCode=#{loginCode}
            </if>
            <if test="id!=null">
                AND id!=#{id}
            </if>
        </trim>
    </select>
    <!--增加用户-->
    <insert id="addUser">
        INSERT INTO au_user(loginCode,password,password2,userName,sex,birthday,cardType,
							 cardTypeName,idCard,country,mobile,email,userAddress,postCode,
							 createTime,referId,referCode,roleId,roleName,userType,userTypeName,
							 isStart,lastUpdateTime,lastLoginTime,bankName,accountHolder,bankAccount,idCardPicPath,bankPicPath)VALUES (
							 #{loginCode},#{password},#{password2},#{userName},#{sex},#{birthday},
							 #{cardType},#{cardTypeName},#{idCard},#{country},#{mobile},#{email},#{userAddress},
							 #{postCode},#{createTime},#{referId},#{referCode},#{roleId},#{roleName},#{userType},
							 #{userTypeName},#{isStart},#{lastUpdateTime},#{lastLoginTime},#{bankName},#{accountHolder},#{bankAccount},#{idCardPicPath},#{bankPicPath}
							 )
    </insert>
    <!--删除用户上传的图片-->
    <update id="delpic">
        UPDATE au_user
        <trim prefix="set" suffixOverrides=",">
            <if test="idCardPicPath!=null">
                idCardPicPath=null,
            </if>
            <if test="bankPicPath != null">
                bankPicPath=null,
            </if>
        </trim>
        WHERE id=#{id}
    </update>
    <!--根据id得到user表信息-->
    <select id="getUser" resultMap="userMap">
        SELECT * FROM au_user where id=#{id}
    </select>
    <!--删除用户-->
    <delete id="delUser">
        DELETE  FROM  au_user WHERE id=#{id}
    </delete>
    <!--通过特定的查询条件的得到user信息-->
    <select id="getUserBySearch" resultMap="userMap">
        SELECT * FROM au_user
        <trim prefix="where" prefixOverrides="and | or">
            <if test="roleId !=null">
                AND roleId=#{roleId}
            </if>
        </trim>
    </select>
    <!--通过条件修改user表角色相关内容-->
    <update id="modifyUserForRole">
        UPDATE au_user SET roleName=#{roleName} WHERE roleId=#{roleId}
    </update>
</mapper>