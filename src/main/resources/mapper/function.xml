<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.demo.sl.dao.function.IFunctionDao">
    <resultMap id="functionMap" type="com.demo.sl.entity.Function" extends="authorityMap">
        <id property="id" column="id"/>
        <result property="functionCode" column="functionCode"/>
        <result property="functionName" column="functionName"/>
        <result property="funcUrl" column="funcUrl"/>
        <result property="parentId" column="parentId"/>
        <result property="creationTime" column="creationTime"/>
    </resultMap>
    <resultMap id="authorityMap" type="com.demo.sl.entity.Authority">
        <id property="id" column="id"/>
        <result property="roleId" column="roleId"/>
        <result property="functionId" column="functionId"/>
        <result property="userTypeId" column="userTypeId"/>
        <result property="creationTime" column="creationTime"/>
        <result property="createdBy" column="createdBy"/>
    </resultMap>
    <!--根据角色得到主功能列表 权限-->
    <select id="getMainFunction" resultMap="functionMap">
        SELECT * FROM au_function WHERE id IN (SELECT functionId FROM au_authority WHERE roleId=#{roleId}) AND parentId=0;
    </select>
    <!--根据角色得到子功能列表 权限-->
    <select id="getSubFunction" resultMap="functionMap">
        SELECT * FROM au_function WHERE parentId=#{id} AND id IN (SELECT functionId FROM au_authority WHERE roleId=#{roleId})
    </select>
    <!--根据id 得到主子功能列表-->
    <select id="getFunctionList" resultMap="functionMap">
        SELECT * FROM au_function WHERE parentId=#{id}
    </select>
    <!--根据条件得到一二三...菜单列表-->
    <select id="getFunctionListByIn" resultMap="functionMap">
        SELECT * FROM au_function WHERE id in (#{str}) OR parentId in (SELECT id FROM au_function where id in (#{strs} AND parentId>0)) or parentId=999
    </select>
</mapper>